- type: entity
  parent: [BaseStructure, ConstructibleMachine]
  id: WeaponTurretUniversal
  suffix: Remote Controlled
  name: universal weapon mount
  description: A remotely-operated turret designed to accept standard hand-held weapons. Being a simple gimbal mount, it is unable to do much besides aiming a gun and firing it.
  components:
  - type: Clickable
  - type: InteractionOutline
  - type: Actions
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeAabb
          bounds: "-0.45,-0.45,0.45,0.45"
        density: 60
        mask:
          - MachineMask
        layer:
          - MachineLayer
  - type: Sprite
    granularLayersRendering: true
    sprite: Objects/Weapons/Guns/Turrets/turrets.rsi
    drawdepth: Mobs
    layers:
      - state: syndie_base
        renderingStrategy: NoRotation
      - map: [ "assblaster" ] # layer to which the weapon is rendered by ItemSlotRenderer
        renderingStrategy: Default
        rotation: -90
  - type: CombatMode
    isInCombatMode: true
    toggleMouseRotator: false
  - type: Damageable
    damageContainer: Inorganic
  - type: Destructible
    thresholds:
      - trigger:
          !type:DamageTrigger
          damage: 200 # Was 600, most players were under the impression these were indestructible. It having an Inorganic damage container did not help.
        behaviors:
          - !type:DoActsBehavior
            acts: [ "Destruction" ]
          - !type:SpawnEntitiesBehavior
            spawn:
              WeaponTurretSyndicateBroken: # Make a broken turret when destroyed.
                min: 1
                max: 1
      - trigger:
          !type:DamageTrigger
          damage: 90 # Rather than fully smash the turret at half health, make an indication that its taking damage.
        # TODO: Construction graph
        behaviors:
          - !type:PlaySoundBehavior
            sound:
              collection: MetalGlassBreak
      - trigger:
          !type:DamageTrigger
          damage: 50 # Helps indicate that the turrets arent indestructible.
        # TODO: Construction graph
        behaviors:
          - !type:PlaySoundBehavior
            sound:
              collection: MetalGlassBreak
  - type: GunFireAngleRestriction
  - type: MouseRotator
    angleTolerance: 0.5
    rotationSpeed: 90
    simple4DirMode: false
  - type: NoRotateOnInteract
  - type: NoRotateOnMove
  - type: Input
    context: "human"
  - type: ContainerContainer
    containers:
      weapon_slot: !type:ContainerSlot
  - type: GunSlot
    slot: weapon_slot
  - type: ItemSlots
    slots:
      weapon_slot:
        ejectOnInteract: false
        ejectOnBreak: true
        swap: false
        name: Weapon slot
        priority: 1
        whitelist:
          components:
          - Gun
  - type: ItemSlotRenderer
    mapping:
      weapon_slot: assblaster
  - type: RemoteControllable
  - type: ManuallyControllable
  - type: RemoteControlOverlay
  - type: Machine
    board: WeaponTurretModularCircuitBoard
  - type: Lock
    locked: false
    lockTime: 3
    unlockTime: 10
  - type: ItemSlotsLock
    slots:
    - weapon_slot
  - type: GunSignalControl
  - type: DeviceNetwork
    deviceNetId: Wireless
    receiveFrequencyId: BasicDevice
  - type: WiredNetworkConnection
  - type: Battery
    maxCharge: 2000
    startingCharge: 0
  - type: ApcPowerReceiverBattery
    idleLoad: 5
    batteryRechargeRate: 200
    batteryRechargeEfficiency: 1.225
  - type: ApcPowerReceiver
    powerLoad: 5
  - type: ExtensionCableReceiver
  - type: Alerts
  - type: Silicon
    entityType: enum.SiliconType.Player
    batteryPowered: True
    drainPerSecond: 2
    speedModifierThresholds:
      4: 1
      3: 1
      2: 1
      1: 1
      0: 0

- type: entity
  id: WeaponTurretModularCircuitBoard
  parent: BaseMachineCircuitboard
  name: modular turret machine board
  description: Circuitboard for a modular turret, which is a fancy way of saying "a servomotor tied to a gun's trigger with a string".
  components:
  - type: Sprite
    state: engineering
  - type: MachineBoard
    prototype: WeaponTurretModularBasic
    requirements:
      Manipulator: 2
    materialRequirements:
      Cable: 5
      Steel: 5